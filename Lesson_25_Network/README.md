# otus-linux
Vagrantfile - для стенда урока 9 - Network

# Дано
Vagrantfile с начальным  построением сети
inetRouter
centralRouter
centralServer

тестировалось на virtualbox

# Планируемая архитектура
построить следующую архитектуру

Сеть office1
- 192.168.2.0/26      - dev
- 192.168.2.64/26    - test servers
- 192.168.2.128/26  - managers
- 192.168.2.192/26  - office hardware

Сеть office2
- 192.168.1.0/25      - dev
- 192.168.1.128/26  - test servers
- 192.168.1.192/26  - office hardware


Сеть central
- 192.168.0.0/28    - directors
- 192.168.0.32/28  - office hardware
- 192.168.0.64/26  - wifi

```
Office1 ---\
      -----> Central --IRouter --> internet
Office2----/
```
Итого должны получится следующие сервера
- inetRouter
- centralRouter
- office1Router
- office2Router
- centralServer
- office1Server
- office2Server

# Теоретическая часть
- Найти свободные подсети
- Посчитать сколько узлов в каждой подсети, включая свободные
- Указать broadcast адрес для каждой подсети
- проверить нет ли ошибок при разбиении

# Практическая часть
- Соединить офисы в сеть согласно схеме и настроить роутинг
- Все сервера и роутеры должны ходить в инет черз inetRouter
- Все сервера должны видеть друг друга
- у всех новых серверов отключить дефолт на нат (eth0), который вагрант поднимает для связи
- при нехватке сетевых интервейсов добавить по несколько адресов на интерфейс


#Решение (Теория) 
Рассмотрим сеть офиса 1 --> 192.168.2.0/26 Маска пгодсети - 26, то есть кол-во узлов можно расчитать по формуле: `2^{32-n}`, где разрядность IPv4 n-маска.
Таким образом в нашей подсети 64 адреса (0-ой и 64 это адреса самой сети и широковещательный адрес).  Первый адрес в сети - 192.168.2.0, последний - 192.168.2.63.
- 192.168.2.64/26    - test servers      от 64 до 127       192.168.2.127 <- broadcast 
- 192.168.2.128/26  - managers           от  128 до 191     192.168.2.191 <- broadcast 
- 192.168.2.192/26  - office hardware    от 192 до 255      192.168.2.255 <- broadcast 
Таким образом свободных подсетей в офисе 1 больше нет.
Аналогично:
Сеть office2
- 192.168.1.0/25      - dev                    2^{32-25}=128 => от 0 до 127      192.168.1.127 <- broadcast 
- 192.168.1.128/26  - test servers             от 128 до 191                     192.168.2.191 <- broadcast 
- 192.168.1.192/26  - office hardware          от 192 до 255                     192.168.2.255 <- broadcast
В офисе 2 так-же отсутствуют свободные подсети.
Сеть central
- 192.168.0.0/28    - directors                 2^{32-28}=16  => от 0 до 15     192.168.0.15 <- broadcast
- 192.168.0.32/28  - office hardware            от 32 до 47                     192.168.0.47 <- broadcast
- 192.168.0.64/26  - wifi                       от 64 до 127                    192.168.0.127 <- broadcast
Тут есть свободные подсети: `192.168.0.16/28, 192.168.0.48/28, 192.168.0.128/25`
Ошибок при разбиении сети нет.

Практическая часть:
Чтобы разрулить правильно маршрутизацию сперва начертим схему сети <br/>
https://github.com/pogosyan-it/otus-linux/blob/master/Lesson_25_Network/Lessson_25.jpg <br/>
Необходимо сделать так чтобы все компьютеры и сервера в обоих офисах имели бы доступ к ресурасм в центральном офисе и через центральный роутер выходили бы в инет.
Для этого внешние интерфейсам роутеров в центральном офисе, в 2-х доп. офисах и внутренний интерфейс на IRouter-e должны быть в отдельных подсетях (чтобы можно было понять какой трафик из какой сети идет и, при необходимости, управлять ими):
Пусть подсеть, объединяющая <br/>
центральный офис и офис1 --> 192.168.100.10/30 <br/>
центральный офис и офис2 --> 192.168.100.20/30 <br/>
центральный офис и IRouter --> 192.168.100.30/30 <br/>
Так как это показано на рисунке. 
Ясно, что на всех роутерах необходимо включить форвардинг трафика: <br/>
`echo "net.ipv4.conf.all.forwarding=1" >> /etc/sysctl.conf`



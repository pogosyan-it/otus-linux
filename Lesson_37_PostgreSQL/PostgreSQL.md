# PostreSQL
Установка PostgreSQL из пакетов, а также сборка из исходного кода, должны выполнятся в соответствии с офф. документацией:
Полезные ссылки:  
<https://www.postgresql.org/download/> <br/>
<https://postgrespro.ru/education/courses/DBA1/>

## Tips and FAQs

# Подключение в БД postgres
1) После устаноки подключится к БД:  
   psql -d postgres (создается пользователь с правми superuser и бд postgres)
2) C внешних серверов:  
   `psql -d база -U роль -h узел -p порт ` 
 
 Чтобы дать разрешение на подключение с удаленных хостов к бд, необходимо:
 1) прописать в файл postgresql.conf  
    `listen_addresses = '*'`, если нужно конкретную подсеть указать, вместо * пишем 192.168.0.0/24 
 2) В файл pg_hba.conf прописать:  
    `host     mybd     postgres     192.168.0.0/24     md5`  
    Запись разрешает подключение к БД mybd пользователю postgres с подсети 192.168.0.0/24, используя пароль.
Узнать расположение файлов конфигурации PostgreSQL: postgresql.conf, pg_hba.conf:  
`ps aux | grep postgres | grep -- -D`  
Для получения информация о текущем подключении:  
`postgres-# \conninfo`  
You are connected to database "postgres" as user "postgres" via socket in "/var/run/postgresql" at port "5432".  
# Создание пользователя  
`CREATE USER user WITH PASSWORD 'mypassword';`
Чтобы подключится к базе под этим пользователем в системе должен быть создан рользователь с таким именем и в файл pg_hba.conf прописано разрешение (см выше)  
Создание пользователя с правами суперпользователя:  
`create user my_user with superuser password 'mypass';`  
Выдать все права для пользователя `user_name` на БД `myDB`:  
`GRANT ALL PRIVILEGES on DATABASE "myDB" to my_user`;
Создать базу данных:  
`Create database myDB;`
Изменение пароля пользователя:  
`ALTER USER MyUser WITH PASSWORD 'NEW_PASS';`
# Мета команды
`\c new_db` сменить базу данных  
`\dt` список таблиц  
`\l` список баз  
`\u` список пользователей  
`\f` список функций  
`\?` - СПРАВКА
# Схемы  
Кластер баз данных — это набор баз данных, которыми управляет один экземпляр сервера. Понятие кластеров баз данных было введено разработчиками OS Ubuntu для упрощения работы с PostgreSQL, для этого был собран специальный пакет postgres-common.
Схема базы данных — это коллекция объектов базы данных, имеющая одного владельца и формирующая одно пространство имен. Две таблицы в одной и той же схеме не могут иметь одно и то же имя.
База данных содержит одну (по умолчанию существует схема public) или несколько именованных схем, которые, в свою очередь, содержат таблицы. Схемы также содержат именованные объекты других видов, включая типы данных, функции и операторы. Одно и то же имя объекта можно свободно использовать в разных схемах, например, и schema1, и myschema могут содержать таблицы с именем mytable.  
   В отличие от баз данных схемы не ограничивают доступ к данным: пользователи могут обращаться к объектам в любой схеме текущей базы данных, если им назначены соответствующие права.
   Есть несколько возможных объяснений, для чего стоит применять схемы:

    Чтобы одну базу данных могли использовать несколько пользователей, независимо друг от друга.
    Чтобы объединить объекты базы данных в логические группы для облегчения управления ими.
    Чтобы в одной базе сосуществовали разные приложения, и при этом не возникало конфликтов имен.  
Схемы в некоторым смысле подобны каталогам в операционной системе, но они не могут быть вложенными.  
Для создания схемы используется команда CREATE SCHEMA. 
`CREATE SCHEMA schema_name;`
Cоздать таблицу в новой схеме можно так:
`CREATE TABLE myschema.mytable (
 ...);`  
Cоздать схему, владельцем которой будет другой пользователь:  
 `CREATE SCHEMA schema_name AUTHORIZATION user_name;`
Список всех схем в бд, схемы которые начинаются с `pg_` - это служебные схемы бд  
 `select * from information_schema.schemata;`  
Важно отметить, что в postgres, для того, чтобы не писать полное имя таблицы `my_schema.my_table` по умолчанию используется путь поиска:  

 `SHOW search_path;`
 `-----------------`
 `"$user", public`
`(1 row)`  

Как видно, если опустить в запросе имя схемы, то поиск будет происходить именно в схеме по умолчанию - public.  
Чтобы добавить в путь нашу новую схему, мы выполняем:  
`SET search_path TO myschema,public;`


`GRANT USAGE on SCHEMA "public" to rebrain_admin;`  
`ALTER DEFAULT PRIVILEGES for role "backup" in schema "public" GRANT Select ON TABLES TO PUBLIC;`  
`GRANT SELECT ON ALL TABLES IN SCHEMA public  TO "rebrain_group_select_access";`
`ALTER DEFAULT PRIVILEGES for role "backup" in schema "public" GRANT Select ON TABLES TO rebrain_admin;`

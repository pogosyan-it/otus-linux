# Установка ОС по сети.

Стэнд состоит из 2-х ВМ, на одной (web-client) поднят apache и опубликован дистрибутив CentOS-8.2.2004-x86_64-minimal.isos, а на второй (dhcp-server) все сервисы, необходимые для загрузки по сети - dhcp, tftp, xinetd. Как обычно, чтобы поднять стэнд необходимо все файлы из репозитория скачать в папку и запустить процесс `vagrant up`. <br/>
   В Vagrantfile прописана загрузка с репозитория яндекса самого дистрибутива, чтобы сократить процесс был выбран минимальный образ Centos8 (Минимальный образ тоже весит больше 2 GB - может возникнуть в процессе скачивания). После загрузки, образ монтируется и содержимое копируется в `/var/www/html`. В нее же копируется файл kikstart, для автоматизации установки дистрибутива. <br/>
   Важно отметить - чтобы загрузка по сети прошла успешно,необходимо чтобы жесткий диск ВМ, на которую будем ставить Centos8 был бы больше 6GB (Суммарный объем разделов, прописанных в кикстарт файле) ну и память должны быть больше 4GB. <br/>
   На 2-й ВМ поднимаем dhcp, причем я из основного конфига dhcpd.conf вынес в отдельный файл (subnet.conf) описание подсети, в которой должен работать наш dhcp сервер, и что важно, файл  /etc/dhcp/rsv.d/deploy-hosts.rsv - в который необходимо прописать MAC адрес карты, IP сервера и имя хоста той ВМ, на которую мы хотим установить ОС.
То есть, что бы проверить работоспособность развернутого стенда, нужно, создать ВМ, желательно в GUI VirtualBox, выбрать в разделе Network - Internal Network  с именем net2 (которое прописано в Vagrantfile), сгенерированный MAC адрес из поля Advanced --> MAC Адрес вписать в файл `/etc/dhcp/rsv.d/deploy-hosts.rsv` и перезапустить сервис. <br/>
    Важно отметить, что menu, которое подгружается по tftp прописано в файле `/var/lib/tftpboot/pxelinux.cfg/default`, в котором первым пунктом идет установка ОС в графическом режиме, а во втором - в текстовом. Именно во втором пункте прописана ссылка на kikstart файл, поэтому для автоматической установки необходимо его выбрать пункт 2.
    

